<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å…¬é–‹ä½œå“ä¸€è¦§</title>
    <style>
        /* --- å…¨ä½“ã®ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬è¨­å®š --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1 {
            color: #4a69bd;
            border-bottom: 2px solid #4a69bd;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #e55039;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 15px;
            border: 1px solid #e55039;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s;
        }
        .back-link:hover {
            background-color: #e55039;
            color: white;
        }

        /* --- ä½œå“ä¸€è¦§ã¨ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .work-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .work-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.2s;
            overflow: hidden;
        }
        .work-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .work-card h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px dotted #ccc;
            padding-bottom: 5px;
            word-break: break-all;
        }
        .work-card p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        /* --- ä½œå“ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .work-content {
            margin-top: 15px;
            border: 1px solid #eee;
            background-color: #fafafa;
            padding: 10px;
            border-radius: 4px;
            max-height: 250px; 
            overflow-y: auto; 
        }
        .work-content img {
            max-width: 100%;
            height: auto;
            display: block;
            border: 1px solid #ccc;
        }
        .work-content pre {
            white-space: pre-wrap; 
            word-break: break-all;
            margin: 0;
            font-size: 0.9em;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ å…¬é–‹ä½œå“ä¸€è¦§</h1>
    <a href="/" class="back-link">â† ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿ã«æˆ»ã‚‹</a>
    <div id="workList" class="work-list">
        <p>ä½œå“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/works')
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`APIã‚¢ã‚¯ã‚»ã‚¹å¤±æ•—: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ${res.status}`);
                    }
                    return res.json();
                })
                .then(works => {
                    const workListDiv = document.getElementById('workList');
                    workListDiv.innerHTML = ''; 

                    if (!works || works.length === 0) {
                        workListDiv.innerHTML = '<p>ã¾ã å…¬é–‹ã•ã‚ŒãŸä½œå“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    // IDãŒå¤§ãã„ã‚‚ã® (æ–°ã—ã„ã‚‚ã®) ã‹ã‚‰è¡¨ç¤º
                    works.sort((a, b) => b.id - a.id).forEach(work => {
                        const card = document.createElement('div');
                        card.className = 'work-card';

                        let contentHtml = '';
                        // content_type ã«å¿œã˜ã¦è¡¨ç¤ºæ–¹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆ
                        if (work.content_type === 'image') {
                            // æç”»ä½œå“ï¼ˆç”»åƒï¼‰ã®å ´åˆ
                            contentHtml = `<img src="${work.content}" alt="å…¬é–‹ã•ã‚ŒãŸæç”»ä½œå“">`;
                        } else {
                            // ãƒ†ã‚­ã‚¹ãƒˆä½œå“ï¼ˆå°èª¬ã€éŸ³æ¥½ï¼‰ã®å ´åˆ
                            contentHtml = `<pre>${work.content}</pre>`;
                        }

                        // ãƒ«ãƒ¼ãƒ åã®æœ€åˆã®æ–‡å­—ã‚’å¤§æ–‡å­—ã«
                        const roomName = work.room ? work.room.charAt(0).toUpperCase() + work.room.slice(1) : 'ä¸æ˜';

                        card.innerHTML = `
                            <h3>${work.title || 'ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰'}</h3>
                            <p><strong>ãƒ«ãƒ¼ãƒ :</strong> ${roomName}</p>
                            <p><strong>å…¬é–‹æ—¥æ™‚:</strong> ${work.published_at ? new Date(work.published_at).toLocaleString() : 'ä¸æ˜'}</p>
                            <div class="work-content">${contentHtml}</div>
                        `;
                        
                        workListDiv.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('ä½œå“ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    document.getElementById('workList').innerHTML = `<p style="color: red;">ä½œå“ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}</p>`;
                });
        });
    </script>
</body>
</html>