<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å…¬é–‹ä½œå“ä¸€è¦§</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; line-height: 1.6; }
        h1 { border-bottom: 2px solid #3498db; padding-bottom: 10px; color: #3498db; }
        .work-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .work-item:hover {
            background-color: #f0f8ff;
        }
        .work-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .work-meta {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        .work-meta span {
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¨ å…¬é–‹ä½œå“å±¥æ­´</h1>
    <div id="loading">ä½œå“ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="works_list">
        </div>
    
    <p style="margin-top: 30px;"><a href="/">[ç·¨é›†ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹]</a></p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingDiv = document.getElementById('loading');
            const worksListDiv = document.getElementById('works_list');

            fetch('/api/published-works') 
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(works => {
                    loadingDiv.style.display = 'none';
                    
                    if (works.length === 0) {
                        worksListDiv.innerHTML = '<p>ã¾ã å…¬é–‹ã•ã‚ŒãŸä½œå“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    works.forEach(work => {
                        const item = document.createElement('div');
                        item.className = 'work-item';
                        
                        const date = new Date(work.published_at);
                        const formattedDate = date.toLocaleDateString('ja-JP') + ' ' + date.toLocaleTimeString('ja-JP');

                        // work.room ãŒãªã„å ´åˆã«å‚™ãˆã¦ 'Unknown' ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ä¿®æ­£æ¸ˆã¿
                        const roomDisplay = work.room ? work.room.charAt(0).toUpperCase() + work.room.slice(1) : 'Unknown';

                        item.innerHTML = `
                            <div class="work-title">${work.title}</div>
                            <div class="work-meta">
                                <span>ãƒ«ãƒ¼ãƒ : ${roomDisplay}</span>
                                <span>å…¬é–‹æ—¥: ${formattedDate}</span>
                                <span>ã‚³ãƒ¡ãƒ³ãƒˆ: ${work.comments ? work.comments.length : 0}ä»¶</span>
                            </div>
                        `;
                        
                        // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§» (IDã‚’URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã™)
                        item.addEventListener('click', () => {
                            window.location.href = `/published-detail?id=${work.id}`;
                        });
                        
                        worksListDiv.appendChild(item);
                    });
                })
                .catch(error => {
                    loadingDiv.textContent = `ä½œå“ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚ (${error.message})`;
                    console.error('Error fetching published works list:', error);
                });
        });
    </script>
</body>
</html>